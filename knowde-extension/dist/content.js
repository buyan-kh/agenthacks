!function(){const e=new class{constructor(){this.isActive=!1,this.highlightColor="#404BD9",this.handleTextSelection=()=>{const e=window.getSelection(),t=e?.toString().trim();t&&t.length>10&&this.showQuickActionTooltip(t)},this.init()}async init(){try{((await chrome.storage.local.get(["settings"])).settings||{}).autoCapture&&this.startAnalysis()}catch(e){console.error("Error initializing content script:",e)}chrome.runtime.onMessage.addListener(((e,t,n)=>(this.handleMessage(e,t,n),!0))),document.addEventListener("keydown",(e=>{e.altKey&&"k"===e.key&&(e.preventDefault(),this.toggleLearningMode())}))}handleMessage(e,t,n){switch(e.type){case"ANALYZE_PAGE":this.analyzePage().then(n);break;case"TOGGLE_LEARNING_MODE":this.toggleLearningMode(),n({success:!0});break;case"CAPTURE_SELECTION":this.captureSelection().then(n);break;default:n({error:"Unknown message type"})}}async analyzePage(){const e={title:document.title,url:window.location.href,content:this.extractTextContent(),timestamp:Date.now()};try{await chrome.runtime.sendMessage({type:"PAGE_ANALYZED",data:e})}catch(e){console.error("Error sending page data:",e)}return e}extractTextContent(){const e=[];return["p","h1","h2","h3","h4","h5","h6","li","article","section"].forEach((t=>{document.querySelectorAll(t).forEach((t=>{const n=t.textContent?.trim();n&&n.length>10&&e.push(n)}))})),e.join(" ").substring(0,5e3)}async captureSelection(){const e=window.getSelection(),t=e?.toString().trim();if(!t)return{text:"",success:!1};this.highlightSelectedText(e);try{const e=(await chrome.storage.local.get(["highlights"])).highlights||[],n={id:Date.now().toString(),text:t,url:window.location.href,title:document.title,timestamp:Date.now()};return e.push(n),await chrome.storage.local.set({highlights:e}),chrome.runtime.sendMessage({type:"TEXT_CAPTURED",highlight:n}),{text:t,success:!0}}catch(e){return console.error("Error capturing selection:",e),{text:t,success:!1}}}highlightSelectedText(e){if(!e||0===e.rangeCount)return;const t=e.getRangeAt(0),n=document.createElement("span");n.style.backgroundColor=this.highlightColor,n.style.color="white",n.style.padding="2px 4px",n.style.borderRadius="3px",n.style.fontWeight="bold",n.className="knowde-highlight";try{t.surroundContents(n)}catch(e){console.log("Could not highlight complex selection")}}toggleLearningMode(){this.isActive=!this.isActive,this.isActive?this.activateLearningMode():this.deactivateLearningMode()}activateLearningMode(){const e=document.createElement("div");e.id="knowde-learning-indicator",e.innerHTML="\n      <div style=\"\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: linear-gradient(135deg, #404BD9, #60C2DA);\n        color: white;\n        padding: 8px 16px;\n        border-radius: 20px;\n        font-family: 'Inter', sans-serif;\n        font-size: 14px;\n        font-weight: 500;\n        z-index: 10000;\n        box-shadow: 0 4px 12px rgba(64, 75, 217, 0.3);\n      \">\n        ðŸ§  Learning Mode Active\n      </div>\n    ",document.body.appendChild(e),document.addEventListener("mouseup",this.handleTextSelection)}deactivateLearningMode(){const e=document.getElementById("knowde-learning-indicator");e&&e.remove(),document.removeEventListener("mouseup",this.handleTextSelection)}showQuickActionTooltip(e){const t=document.getElementById("knowde-tooltip");t&&t.remove();const n=document.createElement("div");n.id="knowde-tooltip",n.innerHTML='\n      <div style="\n        position: absolute;\n        background: white;\n        border: 1px solid #E5E3E6;\n        border-radius: 8px;\n        padding: 8px;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        z-index: 10001;\n        font-family: \'Inter\', sans-serif;\n        font-size: 12px;\n      ">\n        <button id="knowde-learn-more" style="\n          background: #404BD9;\n          color: white;\n          border: none;\n          padding: 4px 8px;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 12px;\n        ">\n          Learn More ðŸ§ \n        </button>\n      </div>\n    ';const o=window.getSelection();if(o&&o.rangeCount>0){const e=o.getRangeAt(0).getBoundingClientRect();n.style.left=`${e.left+window.scrollX}px`,n.style.top=`${e.bottom+window.scrollY+5}px`}document.body.appendChild(n);const i=document.getElementById("knowde-learn-more");i&&i.addEventListener("click",(()=>{this.captureSelection(),n.remove()})),setTimeout((()=>{n.parentNode&&n.remove()}),5e3)}startAnalysis(){this.analyzePage(),setInterval((()=>{this.isActive&&this.analyzePage()}),3e4)}};window.knowdeAnalyzer=e}();